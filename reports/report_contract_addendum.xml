<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- =========================================================
         ADENDA / CONVENIO MODIFICATORIO (EL SALVADOR) - QWEB REPORT
         Replaces: Servicios Contratados + Pagaré sin Protesto
         ========================================================= -->

    <template id="report_contract_addendum_template_es">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="web.basic_layout">

                    <div class="page" style="font-size: 12px;">
                                <t t-set="base_doc" t-value="doc._get_addendum_base_order()"/>
                                <t t-set="base_contract_start" t-value="base_doc.date_order or doc.date_order"/>
                                <t t-set="addendum_date" t-value="doc.create_date or base_contract_start or doc.write_date"/>
                                <t t-set="months"
                                    t-value="{'1': 'enero', '2': 'febrero', '3': 'marzo', '4': 'abril', '5': 'mayo', '6': 'junio', '7': 'julio', '8': 'agosto', '9': 'septiembre', '10': 'octubre', '11': 'noviembre', '12': 'diciembre'}"/>
                                <t t-set="addendum_day" t-value="addendum_date.day if addendum_date else ''"/>
                                <t t-set="addendum_month" t-value="months.get(str(addendum_date.month)) if addendum_date else ''"/>
                                <t t-set="addendum_year" t-value="addendum_date.year if addendum_date else ''"/>
                                <t t-set="contract_day" t-value="base_contract_start.day if base_contract_start else ''"/>
                                <t t-set="contract_month" t-value="months.get(str(base_contract_start.month)) if base_contract_start else ''"/>
                                <t t-set="contract_year" t-value="base_contract_start.year if base_contract_start else ''"/>

                        <div class="col-3">
                            <img t-if="doc.company_id.logo" t-att-src="image_data_uri(doc.company_id.logo)" style="max-height: 100px; margin-left: 2mm" alt="Company Logo"/>
                        </div>
                        <!-- HEADER -->
                        <div class="mb-3">
                            <h3 class="text-center m-0">ADENDA / CONVENIO MODIFICATORIO</h3>
                            <h5 class="text-center mt-1">AL CONTRATO DE PRESTACIÓN DE SERVICIOS</h5>
                            <div class="text-center" style="font-size: 11px;">
                                Adenda Nr.: <strong><t t-esc="base_doc.cabal_sequence or doc.cabal_sequence or ''"/></strong>
                            </div>
                        </div>

                        <!-- PARTY + CONTRACT IDENTIFICATION -->
                        <div class="border rounded p-3 mb-3">
                            <div>
                                En la ciudad de <strong>La Libertad Costa</strong>, a los <strong><t t-esc="addendum_day"/></strong> días del mes de <strong><t t-esc="addendum_month"/></strong> del año <strong><t t-esc="addendum_year"/></strong>,
                                comparecen por una parte <strong>REDES LITORALES, S.A. DE C.V.</strong>, en adelante <strong>“LA EMPRESA”</strong>,
                                y por la otra <strong><t t-esc="doc.partner_id.name"/></strong>,
                                con Documento de Identidad No. <strong><t t-esc="doc.partner_id.sv_dui or ''"/></strong>,
                                en adelante <strong>“EL CLIENTE”</strong>.
                            </div>

                            <div class="mt-2">
                                Las partes manifiestan que han celebrado previamente un Contrato de Prestación de Servicios (el <strong>“Contrato Original”</strong>),
                                identificado como: <strong><t t-esc="base_doc.cabal_sequence or doc.cabal_sequence or ''"/></strong>
                                <t t-if="base_contract_start">
                                    , en fecha <strong><t t-esc="format_date(base_contract_start) if format_date else base_contract_start.strftime('%d/%m/%Y')"/></strong>
                                </t>.
                            </div>

                            <div class="mt-2">
                                Por medio de la presente Adenda, las partes acuerdan modificar el Contrato Original
                                <strong>únicamente</strong> en lo relativo a la sección <strong>“Servicios Contratados”</strong> y al <strong>“Pagaré sin Protesto”</strong>,
                                según se detalla a continuación.
                            </div>
                        </div>

                        <!-- CLAUSE 1: REPLACE CONTRACTED SERVICES -->
                        <div class="mb-3">
                            <h5 class="m-0">PRIMERA: SUSTITUCIÓN DE SERVICIOS CONTRATADOS</h5>
                            <div class="mt-2">
                                A partir de la fecha de firma de la presente Adenda, las partes acuerdan que
                                <strong>se sustituye en su totalidad</strong> la sección denominada <strong>“SERVICIOS CONTRATADOS”</strong> del Contrato Original,
                                quedando sin efecto cualquier versión anterior de dicha sección.
                            </div>
                            <div class="mt-2">
                                Los servicios vigentes se detallan en el <strong>ANEXO 1</strong> de la presente Adenda,
                                el cual forma parte integrante de la misma para todos los efectos legales.
                            </div>
                        </div>

                        <!-- ANNEX 1: SERVICES (REBUILT FROM RECURRING LINES) -->
                        <div class="border rounded p-3 mb-4">
                            <h5 class="m-0">ANEXO 1: SERVICIOS CONTRATADOS (VIGENTES)</h5>

                            <!-- Get recurring products and total (prefer parent contract/order if present) -->
                                     <t t-set="recurring_lines" t-value="doc._get_recurring_lines_for_addendum()"/>
                                     <t t-set="monthly_total" t-value="doc._get_addendum_monthly_total(recurring_lines)"/>

                            <div class="mt-3">
                                <t t-if="recurring_lines">
                                    <t t-foreach="recurring_lines" t-as="line">
                                        <div class="row mb-2">
                                            <div class="col-8">
                                                <span class="bg-light px-2 py-1 d-inline-block">
                                                    Servicio/Plan: <t t-esc="line.name"/>
                                                </span>
                                            </div>
                                            <div class="col-4 text-end">
                                                <span class="bg-light px-2 py-1 d-inline-block">
                                                    US$ <t t-esc="line.price_unit"
                                                          t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/>
                                                </span>
                                            </div>
                                        </div>
                                    </t>

                                    <div class="row mt-3">
                                        <div class="col-8 text-end">
                                            <strong>Mensualidad Total:</strong>
                                        </div>
                                        <div class="col-4 text-end">
                                            <strong>US$ <t t-esc="monthly_total"
                                                          t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/></strong>
                                        </div>
                                    </div>

                                </t>
                                <t t-else="">
                                    <div class="mt-2">
                                        No se encontraron líneas recurrentes en el documento. Verifique que el servicio esté marcado como recurrente.
                                    </div>
                                </t>
                            </div>

                            <div class="mt-3" style="font-size: 0.95em;">
                                Cobro por morosidad en el pago: <strong>5%</strong> (según condiciones del Contrato Original, salvo disposición distinta aplicable).
                            </div>
                        </div>

                        <!-- CLAUSE 2: REPLACE PAGARE -->
                        <div class="mb-3">
                            <h5 class="m-0">SEGUNDA: SUSTITUCIÓN DEL PAGARÉ SIN PROTESTO</h5>
                            <div class="mt-2">
                                Como consecuencia de la actualización de los servicios contratados, las partes acuerdan que el pagaré sin protesto
                                suscrito con anterioridad <strong>queda sin efecto</strong> y es <strong>sustituido en su totalidad</strong> por el pagaré que se adjunta
                                como <strong>ANEXO 2</strong>, el cual refleja las condiciones económicas vigentes.
                            </div>
                        </div>

                        <!-- PAGE BREAK -->
                        <div style="page-break-before: always;"></div>

                        <!-- ANNEX 2: PAGARE SIN PROTESTO (UPDATED) -->
                        <div class="border rounded p-4 mt-2">
                            <div class="row align-items-center">
                                <div class="col-8">
                                    <h5 class="m-0">ANEXO 2: PAGARÉ SIN PROTESTO</h5>
                                </div>
                                <div class="col-4 text-end">
                                    Por US$ <strong>
                                        <t t-esc="doc.contract_value"
                                           t-options="{&quot;widget&quot;: &quot;float&quot;, &quot;precision&quot;: 2}"/>
                                    </strong>
                                </div>
                            </div>

                            <div class="mt-3" style="text-align: justify;">
                                Yo, <strong><t t-esc="doc.partner_id.name"/></strong>, mayor de edad, portador(a) del Documento de Identidad No.
                                <strong><t t-esc="doc.partner_id.vat or ''"/></strong>, por medio del presente PAGARÉ SIN PROTESTO me obligo a pagar
                                a la orden de <strong>REDES LITORALES, S.A. DE C.V.</strong>, en la ciudad de __________________, el día _______ de _________ del año _________,
                                la cantidad de
                                <strong>
                                    <t t-esc="doc.contract_value_amount_to_text()"/> DE LOS ESTADOS UNIDOS DE AMÉRICA
                                </strong>,
                                más los intereses convencionales y/o moratorios que correspondan conforme a las condiciones pactadas.
                            </div>

                            <div class="mt-3" style="text-align: justify;">
                                El presente pagaré sustituye y deja sin efecto cualquier pagaré anterior relacionado al Contrato Original,
                                en virtud de la actualización de servicios efectuada por la presente Adenda.
                            </div>

                            <div class="row mt-5">
                                <div class="col-6 text-center">
                                    <p class="m-0"><strong>Firma del Cliente</strong></p>
                                    <p class="m-0">/sn1/</p>
                                    <div class="mt-4">_______________________________</div>
                                    <div><t t-esc="doc.partner_id.name"/></div>
                                </div>
                                <div class="col-6 text-center">
                                    <p class="m-0"><strong>Redes Litorales SA de CV</strong></p>
                                    <div class="mt-1" style="display: inline-block;">
                                        <table style="margin: 0 auto;">
                                            <tr>
                                                <td style="padding-right: 8px; vertical-align: middle;">
                                                    <img src="/contract_management/static/description/corporate_seal_original.jpg" style="max-height: 60px; vertical-align: middle; display: inline-block;" alt="Sello Redes Litorales"/>
                                                </td>
                                                <td style="vertical-align: middle;">
                                                    <img src="/contract_management/static/description/signature.png" style="max-height: 60px; vertical-align: middle; display: inline-block;" alt="Firma Redes Litorales"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="mt-4">_______________________________</div>
                                    <div>Representante Legal</div>
                                </div>
                            </div>
                        </div>

                        <!-- BACK TO CLAUSE 3 + SIGNATURES -->
                        <div style="page-break-before: always;"></div>

                        <div class="mb-3">
                            <h5 class="m-0">TERCERA: RATIFICACIÓN</h5>
                            <div class="mt-2" style="text-align: justify;">
                                Todas las demás cláusulas del Contrato Original que no hayan sido expresamente modificadas por la presente Adenda
                                <strong>permanecen vigentes</strong> y obligatorias para las partes.
                            </div>
                        </div>

                        <div class="mb-4" style="text-align: justify;">
                            Leída que fue la presente Adenda y enteradas las partes de su contenido y efectos legales, la firman en dos ejemplares
                            del mismo tenor, en la ciudad y fecha arriba indicadas.
                        </div>

                        <div class="row mt-5">
                            <div class="col-6 text-center">
                                <p class="m-0"><strong>EL CLIENTE</strong></p>
                                <p class="m-0">/sn1/</p>
                                 <div class="mt-4">_______________________________</div>
                                <div><t t-esc="doc.partner_id.name"/></div>
                            </div>
                            <div class="col-6 text-center">
                                <p class="m-0"><strong>Redes Litorales SA de CV</strong></p>
                                    <div class="mt-1" style="display: inline-block;">
                                        <table style="margin: 0 auto;">
                                            <tr>
                                                <td style="padding-right: 8px; vertical-align: middle;">
                                                    <img src="/contract_management/static/description/corporate_seal_original.jpg" style="max-height: 60px; vertical-align: middle; display: inline-block;" alt="Sello Redes Litorales"/>
                                                </td>
                                                <td style="vertical-align: middle;">
                                                    <img src="/contract_management/static/description/signature.png" style="max-height: 60px; vertical-align: middle; display: inline-block;" alt="Firma Redes Litorales"/>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                <div class="mt-4">_______________________________</div>
                                <div>Representante Legal</div>
                                <p class ="m-0">/st2/</p>
                            </div>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>

</odoo>